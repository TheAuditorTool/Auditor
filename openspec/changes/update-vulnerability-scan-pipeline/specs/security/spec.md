## ADDED Requirements

### Requirement: Dependency Inventory Coverage
The system MUST build a unified dependency inventory covering every supported ecosystem (Node, Python, others) before running vulnerability scans.

#### Scenario: Python project with requirements file
- **GIVEN** a repository containing `requirements.txt`
- **WHEN** `aud index` completes
- **THEN** the `package_configs` table MUST contain rows for each requirement so the vulnerability scanner can consume them.

#### Scenario: Mixed ecosystem repository
- **GIVEN** a repository with both `package.json` and `pyproject.toml`
- **WHEN** `aud deps --vuln-scan` runs
- **THEN** the scanner MUST merge database rows with parsed manifests so every dependency is audited exactly once.

### Requirement: Deterministic Vulnerability Artifact
The system MUST write `.pf/raw/vulnerabilities.json` on every vulnerability scan, even when no vulnerabilities are found.

#### Scenario: Zero findings
- **GIVEN** the scanners report zero vulnerabilities
- **WHEN** the scan completes
- **THEN** `.pf/raw/vulnerabilities.json` MUST exist with `total_vulnerabilities: 0` and the list of sources executed.

#### Scenario: Tool failure
- **GIVEN** a required native scanner (e.g., pip-audit) is missing or crashes
- **WHEN** `aud deps --vuln-scan` runs
- **THEN** the JSON artifact MUST include `tool_status` details and the CLI MUST mark the phase as failed.

### Requirement: Transparent Failure Handling
The system MUST fail the vulnerability scan phase when prerequisites are missing, surfacing structured errors to operators and downstream tooling.

#### Scenario: Missing dependency inventory
- **GIVEN** the database lacks dependency rows for the active repository
- **WHEN** `aud deps --vuln-scan` runs
- **THEN** the command MUST exit with a non-zero status, explain the inventory gap, and not claim success.

#### Scenario: Missing native binary
- **GIVEN** `pip-audit` or `osv-scanner` is not installed in `.auditor_venv`
- **WHEN** the scan executes
- **THEN** the system MUST stop the phase, report the missing tool, and instruct the user to run the setup command.
