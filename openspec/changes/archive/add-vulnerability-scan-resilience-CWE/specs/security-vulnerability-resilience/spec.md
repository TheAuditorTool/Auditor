## ADDED Requirements

### Requirement: Resilient Vulnerability Tool Execution
The vulnerability scanner MUST record precise telemetry for each native tool invocation and retry transient failures once before surfacing errors.

#### Scenario: Timings captured for successful run
- **GIVEN** ud deps --vuln-scan completes without tool errors
- **WHEN** .pf/raw/vulnerabilities.json is written
- **THEN** each 	ool_status[tool] entry MUST include status, started_at, nded_at, duration_ms, and ttempts: 1.

#### Scenario: Retry succeeds after transient failure
- **GIVEN** a native tool (e.g., npm audit) fails on the first subprocess invocation with a transient non-zero exit code
- **WHEN** the retry succeeds on the second attempt
- **THEN** 	ool_status["npm-audit"] MUST report status: "success", ttempts: 2, and capture stderr/stdout snippets for the failed attempt.

#### Scenario: Failure after retry stops the phase
- **GIVEN** a native tool fails twice in a row
- **WHEN** the scanner finishes
- **THEN** 	ool_status MUST record status: "failed_after_retry" with the captured error output
- **AND** ud deps --vuln-scan MUST exit non-zero while .pf/raw/vulnerabilities.json documents the failure.

### Requirement: CWE Metadata Completeness
The scanner MUST preserve every CWE identifier emitted by native tools in both JSON artifacts and database storage.

#### Scenario: Multiple CWE IDs in OSV finding
- **GIVEN** OSV-Scanner returns a vulnerability with database_specific.cwe_ids = ["CWE-79", "CWE-352"]
- **WHEN** findings are written
- **THEN** the corresponding JSON entry MUST expose "cwe_ids": ["CWE-79", "CWE-352"]
- **AND** the database MUST store both IDs (e.g., via a join table) so downstream analyses can query them.

#### Scenario: Consumers read CWE arrays
- **GIVEN** the Factual Correlation Engine loads dependency findings
- **WHEN** it reads CWE metadata
- **THEN** it MUST accept arrays of CWE IDs without defaulting to the first element and retain them in any derived outputs.

### Requirement: Vulnerability Telemetry Artifacts
The system MUST persist scan telemetry that auditors can inspect independent of console output.

#### Scenario: Status snapshot emitted
- **GIVEN** ud deps --vuln-scan runs to completion (success or failure)
- **WHEN** the command exits
- **THEN** .pf/status/vulnerability-scan.status MUST exist with total duration, per-tool timings, retry counts, and discrepancy summaries.

#### Scenario: CLI surfaces telemetry
- **GIVEN** a scan finishes with mixed outcomes (e.g., OSV success, npm audit failed after retry)
- **WHEN** the CLI prints the phase summary
- **THEN** it MUST reference the telemetry (including failure reasons and durations) and point to .pf/raw/vulnerabilities.json for detailed insights.
