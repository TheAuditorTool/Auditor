## Why
- package_configs cannot represent multi-package manifests; ile_path is the primary key (	heauditor/indexer/schema.py:789-800) and only package.json-family files populate it (	heauditor/indexer/extractors/json_config.py:21-74), leaving Python inventories empty.
- Legacy note: the vulnerability scanner previously shelled pip-audit directly against requirements.txt, ignoring the database and skipping pyproject.toml entirely. That path has since been removed in favor of OSV-Scannerâ€™s offline PyPI coverage.
- Operational telemetry is shallow: 	ool_status only tracks status/error/count (	heauditor/vulnerability_scanner.py:63-70), there is no retry path in _run_* helpers (	heauditor/vulnerability_scanner.py:147-398,442-557), and CWE metadata drops everything beyond the first ID (	heauditor/vulnerability_scanner.py:520-523).
- Without manifest provenance in the database (	heauditor/indexer/database.py:1420-1874), we cannot prove whether dependency rows reflect the current files, breaking the verify-before-acting guarantee.

## What Changes
- Introduce normalized dependency inventory tables:
  - dependency_manifests (file path, manager, manifest type, content hash, parsed_at) and package_dependencies (manifest_id FK, package, specifier, normalized version info, markers, dev/test flags) in 	heauditor/indexer/schema.py/database.py.
  - Provide migrations/backfills and prune stale rows during ud index re-runs.
- Extend extractors without heuristics:
  - Add Python manifest extractors (requirements, pip-tools exports, PEP 621 pyproject) that use ManifestParser/Packaging libraries instead of regex, emitting rows into the new tables.
  - Update existing Node extractors to dual-write per-dependency rows and manifest metadata while still populating package_configs for summary parity.
- Harden the vulnerability scanner:
  - Load dependencies from the new tables, reconcile with parsed manifests, and honor manifest hashes to detect stale inventories.
  - Wrap each native tool call with precise timing (started_at, nded_at, duration_ms), attempt counters, retry once on transient subprocess failures, and emit structured stderr/stdout snippets.
  - Preserve full CWE lists as cwe_ids arrays in JSON and via a inding_cwes join table (or JSON column) on indings_consolidated, updating FCE consumers to handle arrays.
  - Expand .pf/raw/vulnerabilities.json with telemetry (	ool_status timings, retry metadata, inventory discrepancies) while remaining backward compatible for existing readers.
- Surface telemetry to operators:
  - Persist vulnerability scan status snapshots to .pf/status/vulnerability-scan.status and propagate durations/retry results into pipeline summaries and CLI output.
  - Document operational expectations (rerun ud index, ud setup-ai) aligned with the new database-first model.

## Impact
- Restores database-first truth for dependency inventories across Python and Node, enabling OSV scans without filesystem fallbacks.
- Provides auditors and automated agents with verifiable telemetry (timings, retries, manifest hashes) that explains how each vulnerability scan behaved.
- Improves downstream analytics by keeping every CWE identifier and establishing provenance for manifest-derived facts.

## Verification Alignment
- Evidence and hypotheses recorded in openspec/changes/add-vulnerability-scan-resilience/verification.md under SOP v4.20.
- Design trade-offs, migrations, and retry strategy will be detailed in design.md for Auditor review before implementation.
