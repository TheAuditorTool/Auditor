# Verification Report - add-vulnerability-scan-resilience
Generated: 2025-10-16T19:39:42.9836270+07:00
SOP Reference: Standard Operating Procedure v4.20

## Hypotheses & Evidence

1. package_configs already supports multi-package manifests (e.g., Python equirements.txt).
   - Evidence: 	heauditor/indexer/schema.py:789-800 defines package_configs with ile_path as the primary key, preventing multiple rows per manifest.
   - Evidence: 	heauditor/indexer/extractors/json_config.py:21-74 only extracts package.json and related lockfiles; no extractor writes Python manifests into package_configs.
   - Result: ? False.

2. VulnerabilityScanner._run_pip_audit loads dependency inventory from the database rather than raw files.
   - Evidence: 	heauditor/vulnerability_scanner.py:331-345 builds the pip-audit command by checking for equirements.txt/pyproject.toml on disk and only passes -r requirements.txt, never reading from package_configs.
   - Result: ? False.

3. 	ool_status captures execution timing for each native vulnerability tool.
   - Evidence: 	heauditor/vulnerability_scanner.py:63-70 initializes 	ool_status with status, rror, and indings_count only; no started_at, nded_at, or duration fields are populated anywhere in _run_* helpers.
   - Result: ? False.

4. Vulnerability findings preserve every CWE identifier returned by upstream scanners.
   - Evidence: 	heauditor/vulnerability_scanner.py:520-523 assigns only the first entry from database_specific["cwe_ids"] to the cwe field, discarding additional CWE IDs.
   - Result: ? False.

5. Native scanner invocations automatically retry once before surfacing an error.
   - Evidence: _run_npm_audit, _run_pip_audit, and _run_osv_scanner (	heauditor/vulnerability_scanner.py:147-398 and 	heauditor/vulnerability_scanner.py:442-557) perform a single subprocess.run call and immediately mark the tool as rror on exceptions; there is no retry loop or attempt counter.
   - Result: ? False.

6. Indexing tracks manifest metadata (hashes/timestamps) to detect stale dependency rows.
   - Evidence: 	heauditor/indexer/database.py:1420-1874 maintains batch writers for package_configs and lock_analysis only; there is no table or batch for manifest metadata, so stale rows cannot be detected.
   - Result: ? False.

## Discrepancies & Alignment Notes
- Python dependency manifests bypass the database entirely, leaving package_configs empty and blocking database-first scans.
- pip-audit ignores pyproject.toml even after detecting its presence, and relies solely on equirements.txt without falling back to parsed inventory.
- Observability is insufficient: 	ool_status cannot prove when or how long each tool ran, and retry semantics are absent, so transient failures silently become hard errors.
- Only the first CWE survives ingestion, obscuring multi-CWE advisories and weakening downstream correlation.
- Lack of manifest metadata means the system cannot verify whether the index reflects the latest manifests, violating the Prime Directive's verify-before-acting mandate.

## Conclusion
The current pipeline cannot guarantee Python manifests reach the database, offers no per-tool timing or retry safeguards, and truncates vulnerability metadata. A change is required to introduce per-dependency storage, manifest provenance tracking, resilient scanner execution, and complete CWE preservation before we extend the vulnerability scanning capability.