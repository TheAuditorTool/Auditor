name: python-pytest-tests
description: Pytest framework extraction test fixture
language: python

tables:
  python_pytest_fixtures:
    min_rows: 4  # sample_data, database_connection, configure_test_environment, class_fixture
    queries:
      - name: verify_basic_fixture
        sql: SELECT * FROM python_pytest_fixtures WHERE fixture_name = 'sample_data' AND scope = 'function'
        expect_rows: 1

      - name: verify_module_fixture
        sql: SELECT * FROM python_pytest_fixtures WHERE fixture_name = 'database_connection' AND scope = 'module'
        expect_rows: 1

      - name: verify_autouse_fixture
        sql: SELECT * FROM python_pytest_fixtures WHERE autouse = 1
        expect_rows: 1  # configure_test_environment

      - name: verify_session_fixture
        sql: SELECT * FROM python_pytest_fixtures WHERE scope = 'session'
        expect_rows: 1

  python_pytest_parametrize:
    min_rows: 2  # test_double and test_addition parametrize decorators
    queries:
      - name: verify_double_parametrize
        sql: SELECT * FROM python_pytest_parametrize WHERE test_function = 'test_double'
        expect_rows: 1

      - name: verify_parameter_names
        sql: SELECT * FROM python_pytest_parametrize WHERE parameter_names = 'input,expected'
        expect_rows: 1

      - name: verify_addition_parametrize
        sql: SELECT * FROM python_pytest_parametrize WHERE test_function = 'test_addition' AND parameter_names = 'x,y,result'
        expect_rows: 1

  python_pytest_markers:
    min_rows: 6  # slow (2x), skip, skipif, xfail, integration
    queries:
      - name: verify_slow_marker
        sql: SELECT * FROM python_pytest_markers WHERE marker_name = 'slow'
        expect_rows: 2  # test_slow_operation and test_integration_slow

      - name: verify_skip_marker
        sql: SELECT * FROM python_pytest_markers WHERE marker_name = 'skip'
        expect_rows: 1

      - name: verify_skipif_marker
        sql: SELECT * FROM python_pytest_markers WHERE marker_name = 'skipif'
        expect_rows: 1

      - name: verify_xfail_marker
        sql: SELECT * FROM python_pytest_markers WHERE marker_name = 'xfail'
        expect_rows: 1

      - name: verify_custom_marker
        sql: SELECT * FROM python_pytest_markers WHERE marker_name = 'integration'
        expect_rows: 1