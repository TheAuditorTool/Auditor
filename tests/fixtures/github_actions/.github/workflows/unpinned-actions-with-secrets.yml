# VULN: Third-party actions pinned to mutable refs with secret exposure
# Attack: Wait for upstream action maintainer compromise, steal secrets
name: Unpinned Actions with Secrets

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4  # SAFE: First-party action

      # VULN: Mutable version + secret exposure
      - name: Deploy to cloud
        uses: third-party-org/deploy-action@main  # VULN: @main is mutable
        with:
          api_key: ${{ secrets.CLOUD_API_KEY }}  # VULN: Secret exposed

      # VULN: Mutable v1 tag + environment secrets
      - name: Notify Slack
        uses: slackapi/slack-github-action@v1  # VULN: v1 is mutable tag
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}  # VULN: Secret in env

      # VULN: Branch name as version
      - name: Custom action
        uses: company/custom-action@develop  # VULN: Branch names are mutable
        with:
          token: ${{ secrets.CUSTOM_TOKEN }}

  # SAFE COMPARISON: Properly pinned action
  safe-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608  # SAFE: SHA pinned

      - name: Safe deployment
        uses: third-party-org/deploy-action@8ade135a41bc03ea155e62e844d188df1ea18608  # SAFE: SHA
        with:
          api_key: ${{ secrets.CLOUD_API_KEY }}
