# Angular Fixture Verification Spec
# Tests: @Component, @Injectable, @NgModule, DI, RxJS, Guards
# Version: 1.0.0

name: "Angular Enterprise Framework Test Suite"
description: "Angular decorators, DI, services, components, guards, RxJS"

# Test 1: AppModule extraction
- name: "@NgModule extraction"
  type: "module_extraction"
  description: "Verify AppModule with @NgModule decorator"
  query: |
    SELECT name, type, file
    FROM symbols
    WHERE name = 'AppModule' AND file LIKE '%app.module.ts'
  expect:
    - name: "AppModule"
      type: "class"

# Test 2: UserService extraction
- name: "@Injectable UserService"
  type: "service_extraction"
  description: "Verify UserService with @Injectable decorator"
  query: |
    SELECT name, type, file
    FROM symbols
    WHERE name = 'UserService' AND file LIKE '%user.service.ts'
  expect:
    - name: "UserService"
      type: "class"

# Test 3: AuthService extraction
- name: "@Injectable AuthService"
  type: "service_extraction"
  description: "Verify AuthService with DI"
  query: |
    SELECT name, type, file
    FROM symbols
    WHERE name = 'AuthService' AND file LIKE '%auth.service.ts'
  expect:
    - name: "AuthService"
      type: "class"

# Test 4: UserListComponent extraction
- name: "@Component UserListComponent"
  type: "component_extraction"
  description: "Verify component with @Input/@Output"
  query: |
    SELECT name, type, file
    FROM symbols
    WHERE name = 'UserListComponent' AND file LIKE '%user-list.component.ts'
  expect:
    - name: "UserListComponent"
      type: "class"

# Test 5: AuthGuard extraction
- name: "AuthGuard CanActivate"
  type: "guard_extraction"
  description: "Verify route guard implementation"
  query: |
    SELECT name, type, file
    FROM symbols
    WHERE name = 'AuthGuard' AND file LIKE '%auth.guard.ts'
  expect:
    - name: "AuthGuard"
      type: "class"

# Test 6: Taint flow - login credentials
- name: "Login credentials taint"
  type: "taint_tracking"
  description: "Verify credentials -> API -> localStorage"
  query: |
    SELECT source, sink, flow_type
    FROM taint_flows
    WHERE source LIKE '%credentials%' AND sink LIKE '%login%'
      AND file LIKE '%auth.service.ts'
  expect_count_min: 1

# Test 7: Taint flow - user data
- name: "User data taint"
  type: "taint_tracking"
  description: "Verify userData -> createUser -> API POST"
  query: |
    SELECT source, sink, flow_type
    FROM taint_flows
    WHERE source LIKE '%userData%' AND sink LIKE '%createUser%'
      AND file LIKE '%user.service.ts'
  expect_count_min: 1

downstream_impact:
  blueprint:
    - "aud blueprint shows 'Angular: 2 services, 1 component, 1 guard, 1 module'"
    - "DI graph: UserListComponent → UserService → HttpClient"
    - "Route protection: Auth

Guard on /dashboard, /users"

  taint_analyze:
    - "credentials → login() → localStorage (XSS risk)"
    - "userData → createUser() → HTTP POST"
    - "searchQuery → searchUsers() → API request"

  detect_patterns:
    - "Tokens in localStorage (XSS vulnerability)"
    - "Missing CSRF protection on mutations"
    - "Unsubscribed observables (memory leaks)"

patterns_tested:
  angular_patterns:
    - "@Component decorator"
    - "@Injectable with providedIn: 'root'"
    - "@NgModule with providers"
    - "@Input/@Output decorators"
    - "Dependency injection in constructors"
    - "HttpClient for API calls"
    - "RxJS observables and operators"
    - "BehaviorSubject for state"
    - "Route guards (CanActivate)"
    - "Lifecycle hooks (OnInit, OnDestroy)"
