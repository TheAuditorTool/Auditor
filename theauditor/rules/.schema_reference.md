# Schema Reference for Rule Auditing

## REMOVED COLUMNS (Use JOINs instead)

1. **api_endpoints.controls** → JOIN api_endpoint_controls
   - FK: (endpoint_file, endpoint_line) → (file, line)
   - Aggregate with: GROUP_CONCAT(control_name)

2. **sql_queries.tables** → JOIN sql_query_tables
   - FK: (query_file, query_line) → (file_path, line_number)
   - Aggregate with: GROUP_CONCAT(table_name)

3. **assignments.source_vars** → JOIN assignment_sources
   - FK: (assignment_file, assignment_line, assignment_target) → (file, line, target_var)
   - Aggregate with: GROUP_CONCAT(source_var_name)

4. **function_returns.return_vars** → JOIN function_return_sources
   - FK: (return_file, return_line, return_function) → (file, line, function_name)
   - Aggregate with: GROUP_CONCAT(return_var_name)

5. **react_components.hooks_used** → JOIN react_component_hooks
   - FK: (component_file, component_name) → (file, name)
   - Aggregate with: GROUP_CONCAT(hook_name)

6. **react_hooks.dependency_vars** → JOIN react_hook_dependencies
   - FK: (hook_file, hook_line, hook_component) → (file, line, component_name)
   - Aggregate with: GROUP_CONCAT(dependency_name)

## KEY TABLES & COLUMNS

### function_call_args (lines 1187-1206)
- file, line, caller_function, callee_function, argument_index, argument_expr, param_name, callee_file_path

### assignments (lines 1148-1165)
- file, line, target_var, source_expr, in_function, property_path

### symbols (lines 286-305)
- path, name, type, line, col, end_line, type_annotation, parameters, is_typed

### api_endpoints (lines 390-405)
- file, line, method, pattern, path, has_auth, handler_function
- ❌ controls REMOVED

### sql_queries (lines 1054-1068)
- file_path, line_number, query_text, command, extraction_source
- ❌ tables REMOVED

### react_components (lines 1460-1476)
- file, name, type, start_line, end_line, has_jsx, props_type
- ❌ hooks_used REMOVED

### react_hooks (lines 1503-1521)
- file, line, component_name, hook_name, dependency_array, callback_body, has_cleanup, cleanup_type
- ❌ dependency_vars REMOVED

### variable_usage (lines 1365-1381)
- file, line, variable_name (NOT var_name), usage_type, in_component (NOT context), in_hook, scope_level

## BANNED PATTERNS
- LIKE in WHERE clauses (use Python filtering)
- Regex on file content (query DB only)
- Fallback logic (hard fail if query wrong)
- Table existence checks (schema contract guarantees tables exist)
